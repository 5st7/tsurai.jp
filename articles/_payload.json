[{"data":1,"prerenderedAt":639},["Reactive",2],{"articles":3},[4,91,205,408,530,622],{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":9,"description":10,"author":11,"date":15,"layout":16,"body":17,"_type":86,"_id":87,"_source":88,"_file":89,"_extension":90},"/articles/create-digital","articles",false,"","DigitalOceanでk8sを立てた","GKEのプリエンティブインスタンス並に安いと聞いたので、DigitalOceanでk8sを立てて遊び場を作ってみる",{"name":12,"avatarUrl":13,"link":14},"5st7","https://pbs.twimg.com/profile_images/1042510623962275840/1Iw_Mvud_400x400.jpg","https://twitter.com/5st7","2024-2-5","article",{"type":18,"children":19,"toc":83},"root",[20,27],{"type":21,"tag":22,"props":23,"children":24},"element","p",{},[25],{"type":26,"value":10},"text",{"type":21,"tag":28,"props":29,"children":30},"ul",{},[31,43,71],{"type":21,"tag":32,"props":33,"children":34},"li",{},[35,37],{"type":26,"value":36},"Projectを作成する\n",{"type":21,"tag":38,"props":39,"children":42},"img",{"alt":40,"src":41},"dc-create-project.png","/dc-create-project.png",[],{"type":21,"tag":32,"props":44,"children":45},{},[46,48],{"type":26,"value":47},"プロジェクトを作ったらサイドバーからKubernetesを選んでクラスタを作っていく",{"type":21,"tag":28,"props":49,"children":50},{},[51,56],{"type":21,"tag":32,"props":52,"children":53},{},[54],{"type":26,"value":55},"tokyoリージョンとかはなさそうなのでシンガポールを選んだ",{"type":21,"tag":32,"props":57,"children":58},{},[59,61,66],{"type":26,"value":60},"2024年2月5日だとv1.29がrecommendedになってた\n",{"type":21,"tag":38,"props":62,"children":65},{"alt":63,"src":64},"select-region.png","/select-region.png",[],{"type":21,"tag":38,"props":67,"children":70},{"alt":68,"src":69},"select-version.png","/select-version.png",[],{"type":21,"tag":32,"props":72,"children":73},{},[74,76,81],{"type":26,"value":75},"最後にポチポチノードプールを設定して終わり\n",{"type":21,"tag":38,"props":77,"children":80},{"alt":78,"src":79},"node-pool.png","/node-pool.png",[],{"type":26,"value":82},"\n2 vCPU/4GB RAMで 24ドル/月...\nGKEでn2-standard-2をSpotで借りる方が安い・・・？",{"title":8,"searchDepth":84,"depth":84,"links":85},2,[],"markdown","content:articles:create-digital.md","content","articles/create-digital.md","md",{"_path":92,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":93,"description":94,"author":95,"date":96,"layout":16,"body":97,"_type":86,"_id":203,"_source":88,"_file":204,"_extension":90},"/articles/java-performance-on-kubernetes","Java Performance on kubernetesの要約","Kubernetes上でのJavaアプリケーションの実行に関するリソース制限（CPUとメモリ）がアプリケーションのパフォーマンスに与える影響について解説している動画 を見たので要約",{"name":12,"avatarUrl":13,"link":14},"2024-2-15",{"type":18,"children":98,"toc":201},[99,115],{"type":21,"tag":22,"props":100,"children":101},{},[102,104,113],{"type":26,"value":103},"Kubernetes上でのJavaアプリケーションの実行に関するリソース制限（CPUとメモリ）がアプリケーションのパフォーマンスに与える影響について解説している",{"type":21,"tag":105,"props":106,"children":110},"a",{"href":107,"rel":108},"https://www.youtube.com/watch?v=HTtdoRc0BQI",[109],"nofollow",[111],{"type":26,"value":112},"動画",{"type":26,"value":114}," を見たので要約",{"type":21,"tag":28,"props":116,"children":117},{},[118,136,154,172,188],{"type":21,"tag":32,"props":119,"children":120},{},[121,123],{"type":26,"value":122},"リソース制限の影響\n",{"type":21,"tag":28,"props":124,"children":125},{},[126,131],{"type":21,"tag":32,"props":127,"children":128},{},[129],{"type":26,"value":130},"NewRelicの調査によると多くのJavaアプリケーションが1つまたは2つのCPUコアと512MB以下のメモリ制限で実行されているらしい",{"type":21,"tag":32,"props":132,"children":133},{},[134],{"type":26,"value":135},"2つのCPU、1GBの割り当てでもGCのアルゴリズムはSerial GCになる",{"type":21,"tag":32,"props":137,"children":138},{},[139,141],{"type":26,"value":140},"ガベージコレクタの選択と設定\n",{"type":21,"tag":28,"props":142,"children":143},{},[144,149],{"type":21,"tag":32,"props":145,"children":146},{},[147],{"type":26,"value":148},"Serial GCだとG1よりStop The Worldが長い",{"type":21,"tag":32,"props":150,"children":151},{},[152],{"type":26,"value":153},"一般的にG1より効率が悪い",{"type":21,"tag":32,"props":155,"children":156},{},[157,159],{"type":26,"value":158},"JVMの設定\n",{"type":21,"tag":28,"props":160,"children":161},{},[162,167],{"type":21,"tag":32,"props":163,"children":164},{},[165],{"type":26,"value":166},"ヒープサイズに関しては自分で設定したほうがいい",{"type":21,"tag":32,"props":168,"children":169},{},[170],{"type":26,"value":171},"1GB割り当てた時に256MBしか割り当てられなかったりするため",{"type":21,"tag":32,"props":173,"children":174},{},[175,177],{"type":26,"value":176},"スタートアップ時間の最適化\n",{"type":21,"tag":28,"props":178,"children":179},{},[180,185],{"type":21,"tag":32,"props":181,"children":182},{},[183],{"type":26,"value":184},"多くのフレームワークがCPUの数でスレッドプールの数を設定してる",{"type":21,"tag":32,"props":186,"children":187},{},[],{"type":21,"tag":32,"props":189,"children":190},{},[191,193],{"type":26,"value":192},"クラスタとアプリケーションのスケーリング戦略\n",{"type":21,"tag":28,"props":194,"children":195},{},[196],{"type":21,"tag":32,"props":197,"children":198},{},[199],{"type":26,"value":200},"Javaアプリケーションがスケールアップ（リソースを増やす）方がスケールアウト（インスタンス数を増やす）よりも効率的である場合が多いこと, そして適切なクラスタサイズとアプリケーションの設定が重要であるらしい",{"title":8,"searchDepth":84,"depth":84,"links":202},[],"content:articles:java-performance-on-kubernetes.md","articles/java-performance-on-kubernetes.md",{"_path":206,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":207,"description":208,"author":209,"date":210,"layout":16,"body":211,"_type":86,"_id":406,"_source":88,"_file":407,"_extension":90},"/articles/how-adobe-is-optimizing-resource-usage-in-kubernetes","How Adobe is Optimizing Resource Usage in Kubernetesを見たので要約","今更だけど、KubeCon + CloudNativeCon North America 2022で発表されたHow Adobe is Optimizing Resource Usage in Kubernetesを見てコスト最適化頑張りたいとなったので要約しておく\n動画は以下",{"name":12,"avatarUrl":13,"link":14},"2024-1-20",{"type":18,"children":212,"toc":404},[213,217],{"type":21,"tag":22,"props":214,"children":215},{},[216],{"type":26,"value":208},{"type":21,"tag":28,"props":218,"children":219},{},[220,229,247,252,270,293,311,329,368,386],{"type":21,"tag":32,"props":221,"children":222},{},[223],{"type":21,"tag":105,"props":224,"children":227},{"href":225,"rel":226},"https://www.youtube.com/watch?v=iVD5YI1-U_M",[109],[228],{"type":26,"value":225},{"type":21,"tag":32,"props":230,"children":231},{},[232,234],{"type":26,"value":233},"AdobeではAdobe Experience Manager(AEM)をk8sの上で運用している",{"type":21,"tag":28,"props":235,"children":236},{},[237,242],{"type":21,"tag":32,"props":238,"children":239},{},[240],{"type":26,"value":241},"Java",{"type":21,"tag":32,"props":243,"children":244},{},[245],{"type":26,"value":246},"Apache Software FoundationのOSSを使ってる",{"type":21,"tag":32,"props":248,"children":249},{},[250],{"type":26,"value":251},"Azure上で運用されていて25以上のクラスタで動いている",{"type":21,"tag":32,"props":253,"children":254},{},[255,257],{"type":26,"value":256},"k8sのワークロードにはRequestとlimitをつける必要がある",{"type":21,"tag":28,"props":258,"children":259},{},[260,265],{"type":21,"tag":32,"props":261,"children":262},{},[263],{"type":26,"value":264},"Request:どれだけのリソースが保証されているか",{"type":21,"tag":32,"props":266,"children":267},{},[268],{"type":26,"value":269},"limit:どれだけのリソースが消費されているか",{"type":21,"tag":32,"props":271,"children":272},{},[273,275],{"type":26,"value":274},"制限をかけると以下のことが起こりうる",{"type":21,"tag":28,"props":276,"children":277},{},[278,283,288],{"type":21,"tag":32,"props":279,"children":280},{},[281],{"type":26,"value":282},"CPU: CPUスロットリング",{"type":21,"tag":32,"props":284,"children":285},{},[286],{"type":26,"value":287},"Memory: OOM",{"type":21,"tag":32,"props":289,"children":290},{},[291],{"type":26,"value":292},"ephemeral storage: Podのeviction",{"type":21,"tag":32,"props":294,"children":295},{},[296,298],{"type":26,"value":297},"AEMはJavaのアプリケーション",{"type":21,"tag":28,"props":299,"children":300},{},[301,306],{"type":21,"tag":32,"props":302,"children":303},{},[304],{"type":26,"value":305},"JVMは起動時に全てのメモリを確保し、メモリの使用率はk8sからは隠されています",{"type":21,"tag":32,"props":307,"children":308},{},[309],{"type":26,"value":310},"JDK 17以上ではホストではなくコンテナの利用可能なメモリを検出する",{"type":21,"tag":32,"props":312,"children":313},{},[314,316],{"type":26,"value":315},"Kubernetes Cluster AutoScaler",{"type":21,"tag":28,"props":317,"children":318},{},[319,324],{"type":21,"tag":32,"props":320,"children":321},{},[322],{"type":26,"value":323},"CPU/メモリリクエストに基づいてノードの数を増減させる",{"type":21,"tag":32,"props":325,"children":326},{},[327],{"type":26,"value":328},"これでコストを30 - 50 %抑えた",{"type":21,"tag":32,"props":330,"children":331},{},[332,334],{"type":26,"value":333},"Horizontal Pod Autoscaler",{"type":21,"tag":28,"props":335,"children":336},{},[337,342,363],{"type":21,"tag":32,"props":338,"children":339},{},[340],{"type":26,"value":341},"必要に応じてPodの数を増減させる",{"type":21,"tag":32,"props":343,"children":344},{},[345,347],{"type":26,"value":346},"AEMだとCPUの使用率かHTTPの分単位のリクエスト数(rps)がいいのかが考えられる\n",{"type":21,"tag":28,"props":348,"children":349},{},[350],{"type":21,"tag":32,"props":351,"children":352},{},[353,355],{"type":26,"value":354},"CPUの使用率は不適切だった\n",{"type":21,"tag":28,"props":356,"children":357},{},[358],{"type":21,"tag":32,"props":359,"children":360},{},[361],{"type":26,"value":362},"コンテナ起動時のスパイクがカスケード効果を引き起こす可能性があった",{"type":21,"tag":32,"props":364,"children":365},{},[366],{"type":26,"value":367},"HPAを有効にして50 - 70%コストを抑えられた",{"type":21,"tag":32,"props":369,"children":370},{},[371,373],{"type":26,"value":372},"Vertical Pod Autoscaler",{"type":21,"tag":28,"props":374,"children":375},{},[376,381],{"type":21,"tag":32,"props":377,"children":378},{},[379],{"type":26,"value":380},"開発環境などにおいて使っていないときはスケールダウンする",{"type":21,"tag":32,"props":382,"children":383},{},[384],{"type":26,"value":385},"5 - 15 %コストダウン",{"type":21,"tag":32,"props":387,"children":388},{},[389,391],{"type":26,"value":390},"以下の2つはAdobe内部の話なので割愛",{"type":21,"tag":28,"props":392,"children":393},{},[394,399],{"type":21,"tag":32,"props":395,"children":396},{},[397],{"type":26,"value":398},"Hibernation",{"type":21,"tag":32,"props":400,"children":401},{},[402],{"type":26,"value":403},"ARC",{"title":8,"searchDepth":84,"depth":84,"links":405},[],"content:articles:How-Adobe-is-Optimizing-Resource-Usage-in-Kubernetes.md","articles/How-Adobe-is-Optimizing-Resource-Usage-in-Kubernetes.md",{"_path":409,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":410,"description":411,"author":412,"date":413,"layout":16,"body":414,"_type":86,"_id":528,"_source":88,"_file":529,"_extension":90},"/articles/efficient-mysql-performance-1","Efficient MySQL Performance 読書メモ ~その1~","最近Efficient MySQL Performanceを読んでいる",{"name":12,"avatarUrl":13,"link":14},"2023-12-8",{"type":18,"children":415,"toc":525},[416,430,435,442],{"type":21,"tag":22,"props":417,"children":418},{},[419,421,428],{"type":26,"value":420},"最近",{"type":21,"tag":105,"props":422,"children":425},{"href":423,"rel":424},"https://www.amazon.co.jp/Efficient-Mysql-Performance-Practices-Techniques/dp/1098105095",[109],[426],{"type":26,"value":427},"Efficient MySQL Performance",{"type":26,"value":429},"を読んでいる",{"type":21,"tag":22,"props":431,"children":432},{},[433],{"type":26,"value":434},"洋書なので読むのが大変だけど結構面白い\nひとまず第一章のQuery Response Timeの章まで読んだのでそこまで読書メモ",{"type":21,"tag":436,"props":437,"children":439},"h2",{"id":438},"_1-query-response-time",[440],{"type":26,"value":441},"1. Query Response Time",{"type":21,"tag":28,"props":443,"children":444},{},[445,458,471,484,489,507],{"type":21,"tag":32,"props":446,"children":447},{},[448,450],{"type":26,"value":449},"クエリ応答時間がMySQLのパフォーマンスを測る上での北極星になる\n",{"type":21,"tag":28,"props":451,"children":452},{},[453],{"type":21,"tag":32,"props":454,"children":455},{},[456],{"type":26,"value":457},"クエリ応答時間はクエリ実行中のステップやロック待ちなどから構成され、複雑さの範囲を絞り本質的なものに焦点を当てることができる",{"type":21,"tag":32,"props":459,"children":460},{},[461,463],{"type":26,"value":462},"クエリのメトリクスはSlow Query log, Perfomance Schemaから確認する\n",{"type":21,"tag":28,"props":464,"children":465},{},[466],{"type":21,"tag":32,"props":467,"children":468},{},[469],{"type":26,"value":470},"MySQL 8.0より前のバージョンだとSlowQueryLogが提供するメトリクスはQueryTime,lock_time,Rows_sent,Rows_examinedしか提供せず、分析が難しいのでPerfomanceSchemaを元に分析をするといい",{"type":21,"tag":32,"props":472,"children":473},{},[474,476],{"type":26,"value":475},"クエリ解析の目的は、遅い実行時間を解くのではなく、クエリの実行を理解することである\n",{"type":21,"tag":28,"props":477,"children":478},{},[479],{"type":21,"tag":32,"props":480,"children":481},{},[482],{"type":26,"value":483},"クエリ解析には、報告されているクエリメトリクス、メタデータ（Explain, テーブル構造）やアプリケーションの知識を使って解析をする",{"type":21,"tag":32,"props":485,"children":486},{},[487],{"type":26,"value":488},"クエリの解析には、クエリ応答じかn、ロック時間、走査した行、送信した行、影響を受けた行、スキャンの種類、フルジョインの選択、作成したtmpテーブル、クエリカウントの9つのクエリメトリクスが必須となる",{"type":21,"tag":32,"props":490,"children":491},{},[492,494],{"type":26,"value":493},"クエリ応答時間お改善は、直接クエリ最適化と間接クエリ最適化に分けられる\n",{"type":21,"tag":28,"props":495,"children":496},{},[497,502],{"type":21,"tag":32,"props":498,"children":499},{},[500],{"type":26,"value":501},"直接クエリ最適化とは、クエリやインデックスを変更すること",{"type":21,"tag":32,"props":503,"children":504},{},[505],{"type":26,"value":506},"間接クエリ最適化とは、データやアクセスパターンの変更",{"type":21,"tag":32,"props":508,"children":509},{},[510,512],{"type":26,"value":511},"少なくともパフォーマンスが顧客に影響する時、コードを変更する前と後に月に1度クエリプロファイルを確認し、遅いクエリを最適化する\n",{"type":21,"tag":28,"props":513,"children":514},{},[515,520],{"type":21,"tag":32,"props":516,"children":517},{},[518],{"type":26,"value":519},"コード変更の前後でクエリ最適化を優先するエンジニアが多いが、著者の経験ではどちらもしなく、ステージング環境、本番環境で最適化し続けていく",{"type":21,"tag":32,"props":521,"children":522},{},[523],{"type":26,"value":524},"MySQLを高速化するには、レスポンスタイムを短縮化するか、負荷を増加させる方法を取るか考える必要がある",{"title":8,"searchDepth":84,"depth":84,"links":526},[527],{"id":438,"depth":84,"text":441},"content:articles:Efficient-MySQL-Performance-1.md","articles/Efficient-MySQL-Performance-1.md",{"_path":531,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":532,"description":533,"author":534,"date":535,"layout":16,"body":536,"_type":86,"_id":620,"_source":88,"_file":621,"_extension":90},"/articles/stop-using-cpu-limits-with-kubernetes","頼むからKubernetesでCPU制限を使うのはやめてくれという記事を読んだ","「頼むからKubernetesでCPU制限を使うのはやめてくれ」という記事を読んでなるほどな〜〜〜と思った一方で思うところがあったので感想をかく",{"name":12,"avatarUrl":13,"link":14},"2023-11-26T00:00:00.000Z",{"type":18,"children":537,"toc":615},[538,552,558,563,568,587,592,597,602],{"type":21,"tag":22,"props":539,"children":540},{},[541,543,550],{"type":26,"value":542},"「",{"type":21,"tag":105,"props":544,"children":547},{"href":545,"rel":546},"https://home.robusta.dev/blog/stop-using-cpu-limits",[109],[548],{"type":26,"value":549},"頼むからKubernetesでCPU制限を使うのはやめてくれ",{"type":26,"value":551},"」という記事を読んでなるほどな〜〜〜と思った一方で思うところがあったので感想をかく",{"type":21,"tag":553,"props":554,"children":556},"h3",{"id":555},"要約",[557],{"type":26,"value":555},{"type":21,"tag":22,"props":559,"children":560},{},[561],{"type":26,"value":562},"KubernetesのCPU制限の問題: KubernetesにおけるCPU制限は、多くの場合、害になることが多い。実際、これらの制限はKubernetesのCPUスロットリング（処理能力の制限）の主要な原因である。",{"type":21,"tag":22,"props":564,"children":565},{},[566],{"type":26,"value":567},"マーカスとテレサは砂漠を旅しています。彼らは1日3リットルを生み出す魔法の水筒を持っています。人が生きていくためには1日1リットルが必要です。",{"type":21,"tag":569,"props":570,"children":571},"ol",{},[572,577,582],{"type":21,"tag":32,"props":573,"children":574},{},[575],{"type":26,"value":576},"制限なし、リクエストなし: マーカスが貪欲に水をすべて飲み、テレサが喉の渇きで亡くなる。これは、CPU飢餓の状況を表し、特定のプロセスがすべてのリソースを使用し、他のプロセスが必要なリソースを得られずに失敗する例です。",{"type":21,"tag":32,"props":578,"children":579},{},[580],{"type":26,"value":581},"制限あり、リクエストの有無にかかわらず: テレサは病気になり、より多くの水が必要になるが、彼女の制限は1日あたり1リットルで、これが守られるため、彼女は喉の渇きで亡くなる。これは、リソースが存在していても、厳格な制限により使用できない状況を示しています。",{"type":21,"tag":32,"props":583,"children":584},{},[585],{"type":26,"value":586},"制限なし、リクエストあり: マーカスが病気になるが、テレサのために水が保存されているため、彼女は生き残る。これは、CPU制限がないがリクエストが存在する状況を表し、必要なリソースが適切に割り当てられることを示しています。",{"type":21,"tag":22,"props":588,"children":589},{},[590],{"type":26,"value":591},"全体として、これらの話はCPU制限の設定が、リソースの不公平な分配やプロセスの失敗につながる可能性があることを示唆しています。特に、リソースが存在しても、厳格な制限によってその使用が制限される場合、有害な結果を招く可能性があります。",{"type":21,"tag":22,"props":593,"children":594},{},[595],{"type":26,"value":596},"メモリ制限とリクエストに関する注意: この記事はCPUに焦点を当てているが、メモリは圧縮不可能なリソースであるため、メモリに関しては常に制限とリクエストを使用し、両者を等しく設定することを推奨している。",{"type":21,"tag":436,"props":598,"children":600},{"id":599},"感想",[601],{"type":26,"value":599},{"type":21,"tag":28,"props":603,"children":604},{},[605,610],{"type":21,"tag":32,"props":606,"children":607},{},[608],{"type":26,"value":609},"リミットにかかりCPUがスロットルされるとプロセスがCPUを再び使用できるようになるまで待足されるので、例えばP99タイルに大きく影響がでうるのでなるほどなと思った",{"type":21,"tag":32,"props":611,"children":612},{},[613],{"type":26,"value":614},"メモリ制限に関してはlimitとrequestを同値に設定する点において完全同意",{"title":8,"searchDepth":84,"depth":84,"links":616},[617,619],{"id":555,"depth":618,"text":555},3,{"id":599,"depth":84,"text":599},"content:articles:stop-using-cpu-limits-with-kubernetes.md","articles/stop-using-cpu-limits-with-kubernetes.md",{"_path":623,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":624,"description":625,"cover":626,"author":627,"date":628,"layout":16,"body":629,"_type":86,"_id":637,"_source":88,"_file":638,"_extension":90},"/articles/create-blog","Hello World","ブログを作った","/ghost7.webp",{"name":12,"avatarUrl":13,"link":14},"2023-10-04T00:00:00.000Z",{"type":18,"children":630,"toc":635},[631],{"type":21,"tag":22,"props":632,"children":633},{},[634],{"type":26,"value":625},{"title":8,"searchDepth":84,"depth":84,"links":636},[],"content:articles:create-blog.md","articles/create-blog.md",1708534252624]