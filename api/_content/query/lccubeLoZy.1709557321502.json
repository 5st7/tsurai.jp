{"_path":"/articles/how-adobe-is-optimizing-resource-usage-in-kubernetes","_dir":"articles","_draft":false,"_partial":false,"_locale":"","title":"How Adobe is Optimizing Resource Usage in Kubernetesを見たので要約","description":"今更だけど、KubeCon + CloudNativeCon North America 2022で発表されたHow Adobe is Optimizing Resource Usage in Kubernetesを見てコスト最適化頑張りたいとなったので要約しておく\n動画は以下","author":{"name":"5st7","avatarUrl":"https://pbs.twimg.com/profile_images/1042510623962275840/1Iw_Mvud_400x400.jpg","link":"https://twitter.com/5st7"},"date":"2024-1-20","layout":"article","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"今更だけど、KubeCon + CloudNativeCon North America 2022で発表されたHow Adobe is Optimizing Resource Usage in Kubernetesを見てコスト最適化頑張りたいとなったので要約しておく\n動画は以下"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=iVD5YI1-U_M","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.youtube.com/watch?v=iVD5YI1-U_M"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"AdobeではAdobe Experience Manager(AEM)をk8sの上で運用している"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Java"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Apache Software FoundationのOSSを使ってる"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Azure上で運用されていて25以上のクラスタで動いている"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"k8sのワークロードにはRequestとlimitをつける必要がある"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Request:どれだけのリソースが保証されているか"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"limit:どれだけのリソースが消費されているか"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"制限をかけると以下のことが起こりうる"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CPU: CPUスロットリング"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Memory: OOM"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ephemeral storage: Podのeviction"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"AEMはJavaのアプリケーション"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"JVMは起動時に全てのメモリを確保し、メモリの使用率はk8sからは隠されています"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"JDK 17以上ではホストではなくコンテナの利用可能なメモリを検出する"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Kubernetes Cluster AutoScaler"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CPU/メモリリクエストに基づいてノードの数を増減させる"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"これでコストを30 - 50 %抑えた"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Horizontal Pod Autoscaler"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"必要に応じてPodの数を増減させる"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"AEMだとCPUの使用率かHTTPの分単位のリクエスト数(rps)がいいのかが考えられる\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CPUの使用率は不適切だった\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"コンテナ起動時のスパイクがカスケード効果を引き起こす可能性があった"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"HPAを有効にして50 - 70%コストを抑えられた"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vertical Pod Autoscaler"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"開発環境などにおいて使っていないときはスケールダウンする"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"5 - 15 %コストダウン"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"以下の2つはAdobe内部の話なので割愛"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Hibernation"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ARC"}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:articles:How-Adobe-is-Optimizing-Resource-Usage-in-Kubernetes.md","_source":"content","_file":"articles/How-Adobe-is-Optimizing-Resource-Usage-in-Kubernetes.md","_extension":"md"}